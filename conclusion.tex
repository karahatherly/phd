\chapter{Conclusion}
\label{chap:conclusion}
\TODO{Have not finished conclusion yet}


\section{Contributions}

Specifically, we make the following contributions:
\begin{itemize}
\item A capability system for time that has low overhead and does not
  limit the system to a particular scheduling policy, including
  implementation of arbitrary scheduling policies at user level;
\item a notion of CPU reservations that is compatible with
  fast IPC implementations traditionally used in high-performance
  microkernels, and is compatible with established real-time resource-sharing policies;
\item the first OS kernel supporting an explicit notion of
  criticality, orthogonal to priority, in addition to the above;
\item an exploration of implementation in the non-preemptible \selfour
  microkernel and its interaction with the kernel's model of
  user-level management of kernel memory, which is a critical enabler
  of strong spatial isolation.
\end{itemize}

The implementation is complete, and the functional correctness proof is already underway, with the
verification engineering team at Data61, CSIRO. The maximum controlled
priority feature has already been merged to the master kernel, while the rest of the features have
specifications written and first-level refinement proofs are currently in progress. Verification is
beyond the scope of this PhD, although we continue to work closely with the team to assist in
verification. 

\section{Related work}

% survey any related work here not covered by the OS chapter?
Nemesis~\citep{Leslie_MBRBEFH_96} was a single-address-space microkernel designed for multimedia
performance, however this architecture is not suitable for mixed-criticality systems as all the
code must be at the highest criticality.

AUTOBEST~\citep{Zuepke_BL_15} is a separation kernel where the authors demonstrate implementations
of AUTOSAR and ARINC653 in separate partitions.

\minix is a traditional microkernel with a focus on reliability rather than performance.
\citet{Herder_BGHT_06} implemented temporal isolation in \minix by allowing threads to be
selectively switched to \gls{EDF} scheduling, and providing hooks that allowed for a \gls{CBS}
implementation at user level. % TODO why bad.

% already mentioned, refer back, but more detail here?
Quest-V~\citep{Danish_LW_11} provides reservations through \gls{SS}, however \IO and normal
processes are distinguished statically: \IO processes use polling servers and normal processes
use sporadic servers. In Quest-V, separate partitions are assigned to different priority levels,
and communication via shared memory and inter-processor interrupts is permitted between
partitions.

\fiascooc introduced scheduling contexts in order to allow paravirtualised guests to switch between
scheduling context with different parameters in order to provide flattened hierarchical
scheduling~\citep{Lackorzynski_WVH_12}, which prevents scheduling integrity violations when
scheduling multiple real-time guests by exporting scheduling information to the hypervisor.
Scheduling contexts in \fiascooc contained a budget, a replenishment rule, and a priority, and
guests can change scheduling contexts on priority switches and interrupt service routines.

\citet{Petters_LHE_09} completed an implementation of RBED in OKL4.

\section{Future work}

This thesis has covered treating time as a first-class resource, and defined a minimal set of
mechanisms that can be leveraged to implement temporal isolation between threads, even within shared
servers. Our primitives also allow for more complex, application specific user-level schedulers to
be constructed efficiently, as we showed in the evaluation. Although many attempts at integrating a
capability system with the non-fungible resource that is time have existed before, we believe this is
the first complete implementation which provides permission to time while not imposing policy
restrictions. 

We have not considered how frequency scaling should integrate with our model, and not experimented
with multicore scheduling and locking protocols, which we expect can be implemented at user-level.
Both of these topics are promising areas of future research.

\TODO{Frequency scaling}
\TODO{multicore locking and scheduling}


This chapter outlines what this PhD project has accomplished so far and what I plan to achieve in the future.

\section{Progress}

This research will investigate the scheduling and resource sharing problems of running application software at different criticality levels with different scheduling requirements in the context of the verified microkernel, \selfour.
This research will attempt to break new ground by developing a real-time operating system kernel with full system schedulability analysis, including that of the kernel code and scheduler.

The goals of this project are to provide (reproduced from the introduction):

\begin{enumerate}[label=\textbf{G\arabic*}]
  \item \label{G1-c} A principled approach to processor management, treating time as a fundamental kernel resource, while allowing it to be overbooked, a key requirement of mixed-criticality systems;
  \item \label{G2-c} safe resource sharing between applications of different criticalities and different temporal requirements.
\end{enumerate}

This research is motivated by the rise in demand for mixed-criticality systems.
It is clear from \Cref{chap:background} that although much work has been conducted on scheduling algorithms for mixed-criticality systems, little work has considered the implications for operating systems.
In addition, mixed-criticality systems require more strict access control to time than has typically been required from standard real-time systems.
This motivates \ref{G1-c}, which investigates how trusted applications can control the use of time as a resource, such that all timing requirements are met and low criticality tasks cannot compromise the timing requirements of higher criticality tasks.
\ref{G2-c} covers how time flows through shared resources, which may be shared between tasks of
different criticalities and different temporal strictness (\gls{HRT}, \gls{SRT}, best-effort) without violating the real-time requirements.

This research is split into several clear phases: background research (year 1), design and implementation (year 2) and evaluation (year 3).
We are currently at the middle of the evaluation phase, having completed the following:
:
\begin{itemize}
	\item developed primitives in \selfour to allow a diverse range of scheduling options at user-level;
	\item extended the \selfour capability model to apply to time, such that it can be enforced by the kernel;
	\item evolved the current \selfour \gls{IPC} mechanisms to allow for analysable blocking of real-time tasks, as required for mixed-criticality resource sharing.
        \item extended the model to cover and run on \gls{SMP} systems.
        \item built a set of microbenchmarks for evaluating \selfour master against the real-time version.
        \item built several examples including an AES encryption server, and built a variety of timeout exception handling 
\end{itemize}

\subsection{Ongoing Evaluation}

Our design and will be evaluated according to the following qualities over the next 12 months:

\subsubsection{Policy-Mechanism Separation}

The aim of the project is to be as true to the microkernel minimality principle as possible---this means that kernel features should avoid influencing user policy decisions as much as possible.
The motivation for using the microkernel minimality policy is to provide widely-applicable, trustworthy scheduling.
Our case studies should allow us to evaluate how successful our design is in keeping policy and mechanism separate.

\subsubsection{Schedulability analysis}

Designs must be conscious of minimising actual and estimated \gls{WCET} as in order to provide a kernel that allows for schedulability analysis, a full profile of \gls{WCET} must be available.
At the end of the project it should be possible to take a full description of a closed system and irrefutably show that the system is always schedulable.
Similarly, for a mixed-criticality system, it must be possible to show that the critical parts of the system are always schedulable.

\section{Conclusion}

Mixed-criticality real-time systems that provide isolation and hard guarantees at the operating
system level are desirable, due to the unscalable nature of hardware isolation.  Much research has
been conducted into how to schedule workloads for real-time, mixed-criticality systems, however the
implications for operating systems are yet to be examined, with most implementations falling short
of what is required in a highly critical environment.

As a result, this ongoing research investigates the implications of mixed-criticality, real-time
scheduling in the context of a high-assurance operating system, driven by the rise of
mixed-criticality systems in safety-critical environments.  The research investigates the trade-offs
between verification potential, performance and policy-mechanism separation with respect to
mixed-criticality scheduling and resource sharing.  In addition to a real-time iteration of seL4
that offers full-system schedulability analysis including the kernel and scheduler, the
contributions are expected to provide a model for future L4 real-time scheduling primitives and a
novel approach to applying fine-grained permissions to time without sacrificing performance.


